<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- 強制清除快取 Meta Tags -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <title>清邁慢活時光 | Chiang Mai 2026 (Fixed)</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              serif: ['"Playfair Display"', '"Noto Serif TC"', 'serif'],
              sans: ['"Inter"', 'sans-serif'],
            },
            colors: {
              thai: {
                gold: '#C5A059',
                goldLight: '#E6C985',
                pink: '#F28C8C',
                green: '#8CAB8D',
                clay: '#D4A373',
                bg: '#FDFCF8',
                dark: '#2D2A26'
              }
            }
          }
        }
      }
    </script>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;600;700&family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <style>
      html {
        scroll-behavior: smooth;
        scroll-padding-top: 80px;
      }
      body {
        background-color: #FDFCF8;
        color: #2D2A26;
      }
    </style>

    <!-- Import Map for External Modules -->
    <script type="importmap">
    {
      "imports": {
        "react/": "https://aistudiocdn.com/react@^19.2.1/",
        "react": "https://aistudiocdn.com/react@^19.2.1",
        "framer-motion": "https://aistudiocdn.com/framer-motion@^12.23.25",
        "lucide-react": "https://aistudiocdn.com/lucide-react@^0.556.0",
        "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.1/",
        "react-dom/client": "https://aistudiocdn.com/react-dom@^19.2.1/client"
      }
    }
    </script>
    
    <!-- Babel for in-browser compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>

    <!-- Custom Loader Script to Handle TSX on GitHub Pages -->
    <script type="module">
      // Helper to fetch file content
      async function loadScript(url) {
        // Add timestamp to prevent caching of source files
        const res = await fetch(url + '?v=' + new Date().getTime());
        if (!res.ok) throw new Error(`Failed to load ${url}`);
        return await res.text();
      }

      async function init() {
        try {
          console.log("Starting application loader...");

          // 1. Load and Transpile ItineraryData.ts
          // We strip types and convert to JS
          const dataCode = await loadScript('./src/components/ItineraryData.ts');
          const dataTranspiled = Babel.transform(dataCode, { 
            presets: ['typescript'],
            filename: 'ItineraryData.ts'
          }).code;
          const dataBlob = new Blob([dataTranspiled], { type: 'application/javascript' });
          const dataUrl = URL.createObjectURL(dataBlob);

          // 2. Load and Transpile App.tsx
          let appCode = await loadScript('./src/App.tsx');
          // Update the import path to point to our Blob URL instead of the file path
          appCode = appCode.replace(/from\s+['"]\.\/components\/ItineraryData['"]/g, `from "${dataUrl}"`);
          
          const appTranspiled = Babel.transform(appCode, { 
            presets: ['react', 'typescript'],
            filename: 'App.tsx'
          }).code;
          const appBlob = new Blob([appTranspiled], { type: 'application/javascript' });
          const appUrl = URL.createObjectURL(appBlob);

          // 3. Load and Transpile index.tsx
          let indexCode = await loadScript('./src/index.tsx');
          // Update import path for App
          indexCode = indexCode.replace(/from\s+['"]\.\/App['"]/g, `from "${appUrl}"`);
          
          const indexTranspiled = Babel.transform(indexCode, { 
            presets: ['react', 'typescript'],
            filename: 'index.tsx'
          }).code;
          const indexBlob = new Blob([indexTranspiled], { type: 'application/javascript' });
          const indexUrl = URL.createObjectURL(indexBlob);

          // 4. Run the application
          await import(indexUrl);
          console.log("Application loaded successfully!");
          
        } catch (e) {
          console.error("Loader Error:", e);
          document.body.innerHTML = `
            <div style="color:#d32f2f; padding:40px; font-family:sans-serif; text-align:center;">
              <h1 style="font-size:24px; margin-bottom:20px;">無法載入應用程式 (Loading Error)</h1>
              <p>請檢查網路連線或檔案路徑。</p>
              <pre style="background:#f5f5f5; padding:15px; border-radius:8px; text-align:left; display:inline-block;">${e.message}</pre>
            </div>
          `;
        }
      }

      init();
    </script>
  </body>
</html>
